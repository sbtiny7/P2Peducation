<%= form_for([:accounts, @course], :html => {:id => 'online_course', :multipart => true}) do |f| %>

<div class="row">
    <div class="col-md-6">
        <div class="form-group">
            <%= f.text_field :title, :class => "form-control", :placeholder => "请输入标题" %>
            <span class="error_message"></span>
        </div>
        <div class="form-group">
            <%= f.select :category, options_for_select(Course::CATEGORIES, @course.category), {}, {:class => "form-control"} %>
            <span class="error_message"></span>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <%= f.text_field 'start_time_date', :value => @course.start_time.try(:to_s, :date) || '', :class => "form-control datetime js-datepicker", :placeholder => "开始时间" %>
            </div>
            <div class="form-group col-md-3">
                <%= f.select 'start_time_hour', options_for_select((0..23).map{|x| [double(x), x]}, @course.start_time.try(:hour) || Time.now.hour), {}, {:class => "form-control"} %>
            </div>
            <div class="form-group col-md-3">
                <%= f.select 'start_time_min', options_for_select((0..59).map{|x| [double(x), x]}, @course.start_time.try(:min) || 0), {}, {:class => "form-control"} %>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <%= f.text_field 'end_time_date', :value => @course.end_time.try(:to_s, :date) || '', :class => "form-control datetime js-datepicker", :placeholder => "结束时间" %>
            </div>
            <div class="form-group col-md-3">
                <%= f.select 'end_time_hour', options_for_select((0..23).map{|x| [double(x), x]}, @course.end_time.try(:hour) || Time.now.hour), {}, {:class => "form-control"} %>
            </div>
            <div class="form-group col-md-3">
                <%= f.select 'end_time_min', options_for_select((0..59).map{|x| [double(x), x]}, @course.end_time.try(:min) || 0), {}, {:class => "form-control"} %>
            </div>
        </div>
        <div class="form-group">
            <%= f.text_field :price, :class => "form-control", :placeholder => "请输入价格" %>
            <span class="error_message"></span>
        </div>
        <div class="form-group">
            <%= f.number_field :students_max, :class => "form-control", :placeholder => "可容纳学生数量（可选）" %>
            <span class="error_message"></span>
        </div>
    </div>
    <div class="col-md-6">
        <div class="upload_image">
            <div class="ie_preview_wrapper">
                <div class="ie_preview">
                </div>
            </div>
            <img src="<%= @course.image.url %>" class="upload_image" alt="上传图像"/>
            <%= f.file_field :image, :class => "form-control upload_image" %>
            <icon class="upload_image">上传图像</icon>
        </div>
    </div>
</div>

<div class="detail">
    <div class="form-group">
        <%= f.text_area :detail, :class => "form-control" %>
        <span class="error_message"></span>
    </div>
</div>

<div class="actions">
    <a class='btn btn-primary'>提交</a>
    <%= f.submit '提交' %>
</div>
<% end %>

<script type="text/javascript">
$('.upload_image:not(input)').mouseover(function(){
    $('icon.upload_image').show();
}).mouseout(function(){
    $('icon.upload_image').hide();
})

$('input.upload_image').change(function(){
    on_upload_image($(this));
})

function on_upload_image(sender) {
    if( !sender.val().match( /.jpg|.jpeg|.gif|.png|.bmp/i ) ){
        alert('图片格式无效！');
        return false;
    }
    var img = sender.parent().children('img')[0];
    if( sender[0].files &&  sender[0].files[0] ){
        img.src = window.URL.createObjectURL(sender[0].files[0]);
    } else {
        var ie_preview = sender.parent().children('.ie_preview')[0];
        var ie_preview_wrapper = sender.parent().children('.ie_preview_wrapper')[0];
        sender.parent().children('img').hide();
        //sender[0].select();
        var path = document.selection.createRange().text;
        ie_preview_wrapper.css({"filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true',sizingMethod='scale',src=\""+ path + "\")"}).show();
        ie_preview.css({"filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true',sizingMethod='scale',src=\""+ path + "\")"}).show();
    }
}


$('input.datetime').datepicker({ constrainInput: false })
</script>